        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>AnimationSchedulerImplTimer class / dart_web_toolkit_animation Library / API Reference / Dart Web Toolkit</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-40672112-1']);
  _gaq.push(['_setDomainName', 'dartwebtoolkit.com']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
        <body data-library="dart_web_toolkit_animation" data-type="AnimationSchedulerImplTimer">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">API Reference 0.3.22</a>
         &rsaquo; <a href="../dart_web_toolkit_animation.html">dart_web_toolkit_animation</a> &rsaquo; <a href="../dart_web_toolkit_animation/AnimationSchedulerImplTimer.html">AnimationSchedulerImplTimer</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>AnimationSchedulerImplTimer</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>Implementation using a timer for browsers that do not support animation
frames.</p>
<pre class="source">
class AnimationSchedulerImplTimer extends AnimationSchedulerImpl {

 /**
  * The default time in milliseconds between frames. 60 fps == 16.67 ms.
  */
 static int DEFAULT_FRAME_DELAY = 16;

 /**
  * The minimum delay in milliseconds between frames. The minimum delay is
  * imposed to prevent freezing the UI.
  */
 static int MIN_FRAME_DELAY = 5;

 /**
  * The list of animations that are currently running.
  */
 List&lt;AnimationHandleImplTimer&gt; animationRequests = new List&lt;AnimationHandleImplTimer&gt;();

 /**
  * The timer that updates all animations.
  */
 Timer timer;

 AnimationSchedulerImplTimer() {
   timer = new Timer.get(updateAnimations);
 }

 AnimationHandle requestAnimationFrame(AnimationCallback callback, [dart_html.Element element = null]) {
   // Save the animation frame request.
   AnimationHandleImplTimer requestId = new AnimationHandleImplTimer(callback, this);
   animationRequests.add(requestId);

   // Start the timer if it isn't started.
   if (animationRequests.length == 1) {
     timer.schedule(DEFAULT_FRAME_DELAY);
   }

   // Return the request id.
   return requestId;
 }

 bool isNativelySupported() {
   return true;
 }

 void cancelAnimationFrame(AnimationHandle requestId) {
   // Remove the request from the list.
   int index = animationRequests.indexOf(requestId);
   if (index != -1) {
     animationRequests.removeAt(index);
   }

   // Stop the timer if there are no more requests.
   if (animationRequests.length == 0) {
     timer.cancel();
   }
 }

 /**
  * Iterate over all animations and update them.
  */
 void updateAnimations() {
   // Copy the animation requests to avoid concurrent modifications.
   List&lt;AnimationHandleImplTimer&gt; curAnimations = new List&lt;AnimationHandleImplTimer&gt;.from(animationRequests);

   // Iterate over the animation requests.
   Duration duration = new Duration();
   for (AnimationHandleImplTimer requestId in curAnimations) {
     // Remove the current request.
     int index = animationRequests.indexOf(requestId);
     if (index != -1) {
       animationRequests.removeAt(index);
     }

     // Execute the callback.
     //cduration.inMilliseconds); //getStartMillis());
     requestId.getCallback().execute(new DateTime.now().millisecondsSinceEpoch);
   }

   // Reschedule the timer if there are more animation requests.
   if (animationRequests.length &gt; 0) {
     /*
      * In order to achieve as close to 60fps as possible, we calculate the new
      * delay based on the execution time of this method. The delay will be
      * less than 16ms, assuming this method takes more than 1ms to complete.
      */
     timer.schedule(dart_math.max(MIN_FRAME_DELAY, DEFAULT_FRAME_DELAY - duration.inMilliseconds)); //elapsedMillis()));
   }
 }
}
</pre>
</div>
<h3>Extends</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../dart_web_toolkit_animation/AnimationScheduler.html">AnimationScheduler</a></span>&nbsp;&gt;&nbsp;<span class="type-box"><span class="icon-class"></span><a href="../dart_web_toolkit_animation/AnimationSchedulerImpl.html">AnimationSchedulerImpl</a></span>&nbsp;&gt;&nbsp;<span class="type-box"><span class="icon-class"></span><strong>AnimationSchedulerImplTimer</strong></span></p>
<div>
<h3>Static Properties</h3>
<div class="field"><h4 id="DEFAULT_FRAME_DELAY">
<button class="show-code">Code</button>
int         <strong>DEFAULT_FRAME_DELAY</strong> <a class="anchor-link"
            href="#DEFAULT_FRAME_DELAY"
            title="Permalink to AnimationSchedulerImplTimer.DEFAULT_FRAME_DELAY">#</a>
        </h4>
        <div class="doc">
<p>The default time in milliseconds between frames. 60 fps == 16.67 ms.</p>
<pre class="source">
static int DEFAULT_FRAME_DELAY = 16
</pre>
</div>
</div>
<div class="field"><h4 id="MIN_FRAME_DELAY">
<button class="show-code">Code</button>
int         <strong>MIN_FRAME_DELAY</strong> <a class="anchor-link"
            href="#MIN_FRAME_DELAY"
            title="Permalink to AnimationSchedulerImplTimer.MIN_FRAME_DELAY">#</a>
        </h4>
        <div class="doc">
<p>The minimum delay in milliseconds between frames. The minimum delay is
imposed to prevent freezing the UI.</p>
<pre class="source">
static int MIN_FRAME_DELAY = 5
</pre>
</div>
</div>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="">
<button class="show-code">Code</button>
new <strong>AnimationSchedulerImplTimer</strong>() <a class="anchor-link" href="#"
              title="Permalink to AnimationSchedulerImplTimer.AnimationSchedulerImplTimer">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Creates a new <a class="crossref" href="../dart_core/Object.html">Object</a> instance.</p>
<p><a class="crossref" href="../dart_core/Object.html">Object</a> instances have no meaningful state, and are only useful
through their identity. An <a class="crossref" href="../dart_core/Object.html">Object</a> instance is equal to itself
only.</p>
<div class="docs-inherited-from">docs inherited from Object </div></div>
<pre class="source">
AnimationSchedulerImplTimer() {
 timer = new Timer.get(updateAnimations);
}
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="animationRequests">
<button class="show-code">Code</button>
List&lt;<a href="../dart_web_toolkit_animation/AnimationHandleImplTimer.html">AnimationHandleImplTimer</a>&gt;         <strong>animationRequests</strong> <a class="anchor-link"
            href="#animationRequests"
            title="Permalink to AnimationSchedulerImplTimer.animationRequests">#</a>
        </h4>
        <div class="doc">
<p>The list of animations that are currently running.</p>
<pre class="source">
List&lt;AnimationHandleImplTimer&gt; animationRequests = new List&lt;AnimationHandleImplTimer&gt;()
</pre>
</div>
</div>
<div class="field"><h4 id="timer">
<button class="show-code">Code</button>
<a href="../dart_web_toolkit_util/Timer.html">Timer</a>         <strong>timer</strong> <a class="anchor-link"
            href="#timer"
            title="Permalink to AnimationSchedulerImplTimer.timer">#</a>
        </h4>
        <div class="doc">
<p>The timer that updates all animations.</p>
<pre class="source">
Timer timer
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="cancelAnimationFrame">
<button class="show-code">Code</button>
void <strong>cancelAnimationFrame</strong>(<a href="../dart_web_toolkit_animation/AnimationHandle.html">AnimationHandle</a> requestId) <a class="anchor-link" href="#cancelAnimationFrame"
              title="Permalink to AnimationSchedulerImplTimer.cancelAnimationFrame">#</a></h4>
<div class="doc">
<pre class="source">
void cancelAnimationFrame(AnimationHandle requestId) {
 // Remove the request from the list.
 int index = animationRequests.indexOf(requestId);
 if (index != -1) {
   animationRequests.removeAt(index);
 }

 // Stop the timer if there are no more requests.
 if (animationRequests.length == 0) {
   timer.cancel();
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="isNativelySupported">
<button class="show-code">Code</button>
bool <strong>isNativelySupported</strong>() <a class="anchor-link" href="#isNativelySupported"
              title="Permalink to AnimationSchedulerImplTimer.isNativelySupported">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Check if the implementation is natively supported.</p>
<p>@return true if natively supported, false if not</p>
<div class="docs-inherited-from">docs inherited from <a href="../dart_web_toolkit_animation/AnimationSchedulerImpl.html">AnimationSchedulerImpl</a> </div></div>
<pre class="source">
bool isNativelySupported() {
 return true;
}
</pre>
</div>
</div>
<div class="method"><h4 id="requestAnimationFrame">
<button class="show-code">Code</button>
<a href="../dart_web_toolkit_animation/AnimationHandle.html">AnimationHandle</a> <strong>requestAnimationFrame</strong>(<a href="../dart_web_toolkit_animation/AnimationCallback.html">AnimationCallback</a> callback, [Element element = null]) <a class="anchor-link" href="#requestAnimationFrame"
              title="Permalink to AnimationSchedulerImplTimer.requestAnimationFrame">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Schedule an animation, letting the browser decide when to trigger the next
step in the animation.</p><p>
Using this method instead of a timeout is preferred because the browser is
in the best position to decide how frequently to trigger the callback for
an animation of the specified element. The browser can balance multiple
animations and trigger callbacks at the optimal rate for smooth
performance.
</p>
<p>@param callback the callback to fire
@return a handle to the requested animation frame
@param element the element being animated</p>
<div class="docs-inherited-from">docs inherited from <a href="../dart_web_toolkit_animation/AnimationScheduler.html">AnimationScheduler</a> </div></div>
<pre class="source">
AnimationHandle requestAnimationFrame(AnimationCallback callback, [dart_html.Element element = null]) {
 // Save the animation frame request.
 AnimationHandleImplTimer requestId = new AnimationHandleImplTimer(callback, this);
 animationRequests.add(requestId);

 // Start the timer if it isn't started.
 if (animationRequests.length == 1) {
   timer.schedule(DEFAULT_FRAME_DELAY);
 }

 // Return the request id.
 return requestId;
}
</pre>
</div>
</div>
<div class="method"><h4 id="updateAnimations">
<button class="show-code">Code</button>
void <strong>updateAnimations</strong>() <a class="anchor-link" href="#updateAnimations"
              title="Permalink to AnimationSchedulerImplTimer.updateAnimations">#</a></h4>
<div class="doc">
<p>Iterate over all animations and update them.</p>
<pre class="source">
void updateAnimations() {
 // Copy the animation requests to avoid concurrent modifications.
 List&lt;AnimationHandleImplTimer&gt; curAnimations = new List&lt;AnimationHandleImplTimer&gt;.from(animationRequests);

 // Iterate over the animation requests.
 Duration duration = new Duration();
 for (AnimationHandleImplTimer requestId in curAnimations) {
   // Remove the current request.
   int index = animationRequests.indexOf(requestId);
   if (index != -1) {
     animationRequests.removeAt(index);
   }

   // Execute the callback.
   //cduration.inMilliseconds); //getStartMillis());
   requestId.getCallback().execute(new DateTime.now().millisecondsSinceEpoch);
 }

 // Reschedule the timer if there are more animation requests.
 if (animationRequests.length &gt; 0) {
   /*
    * In order to achieve as close to 60fps as possible, we calculate the new
    * delay based on the execution time of this method. The delay will be
    * less than 16ms, assuming this method takes more than 1ms to complete.
    */
   timer.schedule(dart_math.max(MIN_FRAME_DELAY, DEFAULT_FRAME_DELAY - duration.inMilliseconds)); //elapsedMillis()));
 }
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-09-15 10:39:24.405</div>
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
